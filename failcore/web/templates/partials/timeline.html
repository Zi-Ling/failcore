{# Timeline - event list (left panel) #}
<div class="timeline">
    <h3>EVENT TIMELINE</h3>
    {% if events %}
        <div class="timeline-events">
            {% for event in events %}
            <div 
                class="timeline-event event-type-{{ event.type or event.event_type }}"
                data-event-idx="{{ loop.index0 }}"
                onclick="selectEvent({{ loop.index0 }})"
            >
                <div class="event-meta">
                    <span class="event-type-label">{{ (event.event_type or event.type) | upper }}</span>
                    {% if event.seq is defined %}
                        <span class="event-seq">#{{ "%03d"|format(event.seq) }}</span>
                    {% endif %}
                </div>
                {% if event.message %}
                <div class="event-message-preview">
                    {{ event.message[:60] }}{% if event.message|length > 60 %}...{% endif %}
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-timeline">No events</div>
    {% endif %}
</div>

<script>
let selectedEventIndex = null;

function selectEvent(idx) {
    selectedEventIndex = idx;
    
    // Update selection UI
    document.querySelectorAll('.timeline-event').forEach((el, i) => {
        el.classList.toggle('selected', i === idx);
    });
    
    // Update inspector panel
    const event = {{ events | tojson | safe }}[idx];
    document.getElementById('inspector-content').innerHTML = renderEventInspector(event);
}

function renderEventInspector(event) {
    return `
        <h4>EVENT #${event.seq || '?'}: ${event.event_type || event.type}</h4>
        <div class="inspector-section">
            <h5>MESSAGE</h5>
            <div class="inspector-value">${event.message || 'N/A'}</div>
        </div>
        ${event.data ? `
        <div class="inspector-section">
            <h5>DATA</h5>
            <pre class="inspector-code">${JSON.stringify(event.data, null, 2)}</pre>
        </div>
        ` : ''}
        ${event.timestamp ? `
        <div class="inspector-section">
            <h5>TIMESTAMP</h5>
            <div class="inspector-value">${event.timestamp}</div>
        </div>
        ` : ''}
    `;
}

// Auto-select first event
if ({{ events | length }} > 0) {
    selectEvent(0);
}
</script>
